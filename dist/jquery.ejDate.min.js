!function(e){"use strict";e.fn.ejDate=function(t){var n,a=this,i={},c=new Date,r=c.getFullYear(),o=c.getMonth()+1,d={yearULV:c.getFullYear(),yearDLV:1970};"undefined"!=typeof t&&(d.yearULV=t.yearULV||d.yearULV,d.yearDLV=t.yearDLV||d.yearDLV,d.disabledDateReg=t.disabledDateReg||d.disabledDateReg,d.checkedDateFunc=t.checkedDateFunc||d.checkedDateFunc);var l=function(){i.mainElem=e('<div class="ejdate-main">').html('<table><caption>                        <span class="btn-cut before-date"></span>                        <select class="select-year"></select>                        <select class="select-month"></select>                        <span class="btn-cut after-date"></span></caption>                        <thead><tr><th>一</th><th>二</th><th>三</th><th>四</th><th>五</th><th>六</th><th>七</th></tr></thead>                        <tbody></tbody></table>'),a.append(i.mainElem),i.targetInput=i.mainElem.prev(),i.selectYear=i.mainElem.find(".select-year"),i.selectMonth=i.mainElem.find(".select-month"),i.btnBefore=i.mainElem.find(".before-date"),i.btnAfterDate=i.mainElem.find(".after-date"),i.tbody=i.mainElem.find("table tbody"),i.targetInput.attr("readonly","readonly"),s(),h(),i.btnBefore.click(function(){u(new Date(r,o-1-1)),p()}),i.btnAfterDate.click(function(){u(new Date(r,o-1+1)),p()}),i.selectYear.change(function(){u(new Date(this.value,o-1))}),i.selectMonth.change(function(){u(new Date(r,this.value-1))}),i.tbody.on("click",".day-normal",function(t){a.setDate(r,o,e(this).html()),e(this).addClass("active");var c=r+"-"+o+"-"+e(this).html();i.targetInput.val(c),"function"==typeof d.checkedDateFunc&&d.checkedDateFunc(n),i.mainElem.hide()}),i.targetInput.click(function(e){i.mainElem.show(),e.stopPropagation()}),e(document).click(function(){i.mainElem.hide()}),i.mainElem.click(function(e){e.stopPropagation()}),i.mainElem.hide()},s=function(){var t,n;for(n=d.yearULV;n>=d.yearDLV;n--)t=e("<option>"+n+"年</option>").val(n),n===r&&(t[0].selected=!0),i.selectYear.append(t);for(n=1;n<=12;n++)t=e("<option>"+n+"月</option>").val(n),n===o&&(t[0].selected=!0),i.selectMonth.append(t)},h=function(){i.tbody.html("");var t,n,a,r,o=f(c);for(t=e("<tr></tr>"),a=0;a<o.length;a++){r=o[a].substring(o[a].indexOf("-")+1),n=e("<td></td>").html(r),t.append(n);var d=o[a].indexOf("dimmed")!==-1;d||y(r)?n.addClass("day-dimmed"):n.addClass("day-normal"),D(r)&&!d&&n.addClass("active"),(a+1)%7===0&&(i.tbody.append(t),41!==a&&(t=e("<tr></tr>")))}},u=function(e){var t=e.getFullYear();return!(t>d.yearULV||t<d.yearDLV)&&(c=e,r=t,o=c.getMonth()+1,void h())},f=function(e){var t,n=m(r,o),a=m(r,o-1),i=new Date(r,o-1,1).getDay(),c=6-(7-i),d=[],l=a-c;for(t=0;t<c;t++)d[t]="dimmed-"+(l+t+1);for(t=1;t<=n;t++)d.push("normal-"+t);for(t=1;d.length<42;t++)d.push("dimmed-"+t);return d},m=function(e,t){var n;return n=2===t?e%4===0?29:28:1===t||3===t||5===t||7===t||8===t||10===t||12===t?31:30},p=function(){i.selectYear.find("option").each(function(){e(this).text()==r+"年"&&(e(this)[0].selected=!0)}),i.selectMonth.find("option").each(function(){e(this).text()==o+"月"&&(e(this)[0].selected=!0)})},y=function(e){if(d.disabledDateReg){var t,n=r+"y"+o+"m"+e+"d";return t=d.disabledDateReg.test(n)}},D=function(e){if(n){var t=n.getFullYear()===r,a=n.getMonth()+1===o,i=n.getDate()==e,c=t&&a&&i;return c}};return e.extend(this,{getDate:function(){return n},setDate:function(e,t,a){i.tbody.find(".active").removeClass("active"),n=new Date(e,t-1,a)}}),l(),this}}(jQuery);