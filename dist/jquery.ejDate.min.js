!function(e){"use strict";e.fn.ejDate=function(t){var a,n=this,i={},c=new Date,r=c.getFullYear(),d=c.getMonth()+1,o={yearULV:c.getFullYear(),yearDLV:1970};"undefined"!=typeof t&&(o.yearULV=t.yearULV||o.yearULV,o.yearDLV=t.yearDLV||o.yearDLV,o.disabledDateReg=t.disabledDateReg||o.disabledDateReg,o.checkedDateFunc=t.checkedDateFunc||o.checkedDateFunc);var l=function(){i.mainElem=e('<div class="ejdate-main">').html('<table><caption>                        <span class="btn-cut before-date"></span>                        <select class="select-year"></select>                        <select class="select-month"></select>                        <span class="btn-cut after-date"></span></caption>                        <thead><tr><th>一</th><th>二</th><th>三</th><th>四</th><th>五</th><th>六</th><th>七</th></tr></thead>                        <tbody></tbody></table>'),n.wrap('<div class="ejdate-wrap">'),n.after(i.mainElem),i.targetInput=n,i.selectYear=i.mainElem.find(".select-year"),i.selectMonth=i.mainElem.find(".select-month"),i.btnBefore=i.mainElem.find(".before-date"),i.btnAfterDate=i.mainElem.find(".after-date"),i.tbody=i.mainElem.find("table tbody"),i.targetInput.attr("readonly","readonly"),s(),h(),i.btnBefore.click(function(){f(new Date(r,d-1-1)),p()}),i.btnAfterDate.click(function(){f(new Date(r,d-1+1)),p()}),i.selectYear.change(function(){f(new Date(this.value,d-1))}),i.selectMonth.change(function(){f(new Date(r,this.value-1))}),i.tbody.on("click",".day-normal",function(t){n.setDate(r,d,e(this).html()),e(this).addClass("active");var c=r+"-"+d+"-"+e(this).html();i.targetInput.val(c),"function"==typeof o.checkedDateFunc&&o.checkedDateFunc(a),i.mainElem.hide()}),i.targetInput.click(function(e){i.mainElem.show(),e.stopPropagation()}),e(document).click(function(){i.mainElem.hide()}),i.mainElem.click(function(e){e.stopPropagation()}),i.mainElem.hide()},s=function(){var t,a;for(a=o.yearULV;a>=o.yearDLV;a--)t=e("<option>"+a+"年</option>").val(a),a===r&&(t[0].selected=!0),i.selectYear.append(t);for(a=1;a<=12;a++)t=e("<option>"+a+"月</option>").val(a),a===d&&(t[0].selected=!0),i.selectMonth.append(t)},h=function(){i.tbody.html("");var t,a,n,r,d=u(c);for(t=e("<tr></tr>"),n=0;n<d.length;n++){r=d[n].substring(d[n].indexOf("-")+1),a=e("<td></td>").html(r),t.append(a);var o=d[n].indexOf("dimmed")!==-1;o||y(r)?a.addClass("day-dimmed"):a.addClass("day-normal"),D(r)&&!o&&a.addClass("active"),(n+1)%7===0&&(i.tbody.append(t),41!==n&&(t=e("<tr></tr>")))}},f=function(e){var t=e.getFullYear();return!(t>o.yearULV||t<o.yearDLV)&&(c=e,r=t,d=c.getMonth()+1,void h())},u=function(e){var t,a=m(r,d),n=m(r,d-1),i=new Date(r,d-1,1).getDay(),c=6-(7-i),o=[],l=n-c;for(t=0;t<c;t++)o[t]="dimmed-"+(l+t+1);for(t=1;t<=a;t++)o.push("normal-"+t);for(t=1;o.length<42;t++)o.push("dimmed-"+t);return o},m=function(e,t){var a;return a=2===t?e%4===0?29:28:1===t||3===t||5===t||7===t||8===t||10===t||12===t?31:30},p=function(){i.selectYear.find("option").each(function(){e(this).text()==r+"年"&&(e(this)[0].selected=!0)}),i.selectMonth.find("option").each(function(){e(this).text()==d+"月"&&(e(this)[0].selected=!0)})},y=function(e){if(o.disabledDateReg){var t,a=r+"y"+d+"m"+e+"d";return t=o.disabledDateReg.test(a)}},D=function(e){if(a){var t=a.getFullYear()===r,n=a.getMonth()+1===d,i=a.getDate()==e,c=t&&n&&i;return c}};return e.extend(this,{getDate:function(){return a},setDate:function(e,t,n){i.tbody.find(".active").removeClass("active"),a=new Date(e,t-1,n)}}),l(),this}}(jQuery);